(function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},n=[].slice,r=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("jview/cards",function(e){var $,r,i,s,o,a,u,c,l,d,h,f;return $=e("jquery"),f=e("jmodel/topaz"),e("jmodel-plugins/jquery.emerald"),e("jmodel-plugins/emerald.keys"),h=function(e){return function(t){return f.event.after(e).subscribe(t)}},$.target=function(e){return function(t){var n;return n=t.target,e.call($(n))}},s=function(){function e(){this.events=new f.EventRegistry("ready","dispose","current"),this.event("ready").remember(1),this.li=$(this.li?this.li:'<li class="card"/>'),this.li.addClass(this["class"]),this.li.event("click",".close").subscribe(function(e){return function(){return e.event("dispose").raise(e),!1}}(this))}return e.prototype.event=function(e){return this.events.get(e)},e}(),r=function(e){function n(){n.__super__.constructor.call(this),this.events.add("load",f.event.fromAjax(this.load)),this.event("load").subscribe(function(e){return function(t){return e.init(t)}}(this))}return t(n,e),n.prototype["class"]="",n.prototype.load=null,n.prototype.get=function(e){return this.event("load").start(e)},n.prototype.init=function(e){return this.li.html(e),this.li.toggleClass("error",$(e).hasClass("error")),this.url=this.li.children("article").data("url"),this.event("ready").raise(this)},n}(s),a=function(){function e(e,t){this.external=e,this.application=t,this.cards=new f.ObservableTypedList(s),this.events=new f.EventRegistry("add","insert","replace","remove","count","ready"),this.event("ready").remember(1),this.cards.events.republish({add:this.event("add"),insert:this.event("insert"),replace:this.event("replace"),remove:this.event("remove")}),f.disjoin(this.cards.event("add"),this.cards.event("insert"),this.cards.event("replace").map(function(e,t){return t})).subscribe(function(e){return function(t){return t.event("ready").subscribe(function(t){return e.event("ready").raise(t)}),t.event("dispose").subscribe(function(t){return e.cards.remove(t)})}}(this))}return e.prototype.event=function(e){return this.events.get(e)},e.prototype.add=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],(t=this.cards).add.apply(t,e)},e.prototype.insert=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],(t=this.cards).insert.apply(t,e)},e.prototype.replace=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],(t=this.cards).replace.apply(t,e)},e.prototype.remove=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],(t=this.cards).remove.apply(t,e)},e.prototype.get=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],(t=this.cards).get.apply(t,e)},e.prototype.count=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],(t=this.cards).count.apply(t,e)},e.prototype.first=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],(t=this.cards).first.apply(t,e)},e.prototype.each=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],(t=this.cards).each.apply(t,e)},e}(),u=function(){function e(e,t,r){this.cards=e,this.duration=null!=r?r:750,this.element=$(t),this.events=new f.EventRegistry("ready","removed"),this.cards.events.subscribe({add:function(e){return function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],e.add.apply(e,t)}}(this),insert:function(e){return function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],e.insert.apply(e,t)}}(this),replace:function(e){return function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],e.replace.apply(e,t)}}(this),remove:function(e){return function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],e.remove.apply(e,t)}}(this)})}return e.prototype.event=function(e){return this.events.get(e)},e.prototype.fold=function(){return this.element.find("li.card").each(function(e,t){return $(t).css({"-webkit-transform":"rotate("+(4*(e%2)-2)+"deg)",left:-1*$(t).position().left+100*e+"px"})})},e.prototype.add=function(e){return this.element.find("li.card").removeClass("zoomed"),this.element.append('<li class="extent"><ul><li class="label hidden"></li></ul></li>'),e.event("ready").take(1).subscribe(function(t){return function(){return e.li.children().addClass("adding"),h(1)(function(){return t.element.children("li.extent:last").children("ul").append(e.li),h(1)(function(){return e.li.children().removeClass("adding"),t.event("ready").raise(e),h(350)(function(){return t.element.find("li.extent > ul > li.label").removeClass("hidden")})})})}}(this))},e.prototype.insert=function(e,t){var n,r;return n=this.element.find("li.card"),n.removeClass("zoomed"),this.element.find("li.extent > ul > li.label").removeClass("hidden"),r=e.li,r.addClass("adding"),0===t?this.element.find("li.card").eq(0).before(r):this.element.find("li.card").eq(t-1).after(r),e.event("ready").take(1).subscribe(function(t){return function(){return h(1)(function(){var n;return n=Math.min(window.innerWidth,r.children("article").outerWidth(!0)),r.css("width",n),h(1)(function(){return r.removeClass("adding"),t.event("ready").raise(e)})})}}(this))},e.prototype.replace=function(e,t){return t.event("ready").take(1).subscribe(function(n){return function(){return e.li.removeClass("zoomed").after(t.li),t.li.removeClass("zoomed"),h(n.duration)(function(){return $("body").animate({scrollLeft:$("body").width()},1e3,function(){return e.li.remove(),t.li.addClass("zoomed"),h(350)(function(){return n.event("ready").raise(t)})})})}}(this))},e.prototype.remove=function(e){var t;return t=e.li,t.children().addClass("removing"),h(this.duration)(function(n){return function(){return t.addClass("removing"),h(1)(function(){var r;return r=t.closest("li.extent"),t.remove().removeClass("removing"),t.children().removeClass("removing"),n.event("removed").raise(e),0===r.find("li.card").length&&r.remove(),1===n.cards.count()?h(1)(function(){return n.element.find("li.card").addClass("zoomed"),n.element.find("li.extent > ul > li.label").addClass("hidden")}):void 0})}}(this))},e}(),d=function(){function e(e,t,n,r){var i;this.cardListView=e,this.offset=null!=r?r:64,this.element=$(t),this.controls=$(n),this.state=new f.ObservableObject({index:{type:Number,defaultValue:0,remember:1,repeat:!0}}),this.state.event("index").subscribe(function(e){return function(t){return e.scrollTo(t)}}(this)),this.state.event("index").subscribe(function(e){return function(t){var n,r;return"function"==typeof(n=e.cardListView.cards.get(t)).event&&null!=(r=n.event("current"))?r.raise():void 0}}(this)),f.conjoin(this.cardListView.element.event("mousedown","li.card"),this.cardListView.element.event("mouseup","li.card")).map(function(e,t){return{target:$(e.target),deltaX:t.screenX-e.screenX,deltaY:t.screenY-e.screenY}}).where(Function.and(function(e){var t;return t=e.target,0===t.closest("a").length},function(e){var t;return t=e.deltaX,t>-3&&3>t},function(e){var t;return t=e.deltaY,t>-3&&3>t})).subscribe(function(e){return function(t){var n,r;return n=t.target,r=n.closest("li.card").index("li.card"),r!==e.state.index()?e.state.index(n.closest("li.card").index("li.card")):void 0}}(this)),i=$(document).event("keydown").where(function(e){var t;return t=e.target,0===$(t).closest("input,select,textarea,[contentEditable=true]").length}),f.disjoin(i.where(f.key(":left")).map(function(){return-1}),i.where(f.key(":right")).map(function(){return 1})).subscribe(function(e){return function(t){return e.state.index(Math.max(0,Math.min(e.cardListView.cards.count()-1,e.state.index()+t))),!1}}(this)),f.disjoin(this.cardListView.event("ready"),this.cardListView.event("removed")).subscribe(function(e){return function(){return e.controls.toggleClass("hidden",1===e.cardListView.cards.count())}}(this)),this.cardListView.event("removed").subscribe(function(e){return function(){return e.state.index(Math.min(e.cardListView.cards.count()-1,e.state.index()+1))}}(this)),this.controls.find("button.zoom").event("click").subscribe(function(e){return function(t){return e.zoom(t)}}(this)),this.cardListView.element.event("click","li.card").subscribe(function(e){return function(t){return e.unzoom(t)}}(this)),this.controls.find("button.close").event("click").subscribe(function(e){return function(){return e.cardListView.cards.remove(function(e){return e.li.index("li.card")>0})}}(this)),f.disjoin(this.cardListView.event("ready"),this.cardListView.event("removed")).subscribe(function(e){return function(){var t;return t=e.cardListView.cards.count(),e.controls.find(".count").text(t+" card"+(1!==t?"s":""))}}(this)),f.disjoin(this.cardListView.event("ready"),this.state.event("index")).map(function(e){return function(){return[e.state.index(),e.cardListView.cards.count()]}}(this)).subscribe(function(e){return function(t){var n,r;return r=t[0],n=t[1],e.controls.find(".previous").toggleClass("disabled",2>n||0===r),e.controls.find(".next").toggleClass("disabled",2>n||r===n-1)}}(this)),f.disjoin(this.controls.find(".previous").event("click").tag(-1),this.controls.find(".next").event("click").tag(1)).where($.target(function(){return!this.hasClass("disabled")})).subscribe(function(e){return function(t,n){return e.state.index(function(e){return e+n})}}(this)),this.controls.find(".list").closest("li").event("click","a").subscribe(function(e){return function(t){var n;return n=t.target,e.state.index($(n).data("index")),e.controls.find(".list").closest("li").children("div").fadeOut(),!1}}(this)),this.controls.find(".list").event("click").subscribe(function(e){return function(t){var n,r,i;return i=t.target,n=$(i).closest("li").children("div"),n.is(":visible")?n.fadeOut():(r=n.children("ul"),r.children().remove(),e.cardListView.cards.each(function(e,t){return r.append($("<li><a data-index='"+t+"' href='#'>"+e.title+"</a></li>"))}),n.fadeIn())}}(this))}return e.offsets=[],e.width=0,e.scrollLeft=0,e.prototype.scrollTo=function(e,t){var n;return null==t&&(t=300),n=this.cardListView.element.find("li.card").eq(e),n.length>0?this.element.stop().animate({scrollLeft:this.element.scrollLeft()+n.position().left+parseInt(n.css("margin-left"),10)+"px"},t):void 0},e.prototype.nudge=function(){var e;return e=this.element.scrollLeft(),this.element.animate({scrollLeft:parseInt(e,10)+200},500,function(t){return function(){return f.event.after(500).subscribe(function(){return t.element.animate({scrollLeft:e},500)})}}(this))},e.prototype.zoom=function(e){return this.element.addClass("zoomed"),this.offsets=[],this.width=0,this.cardListView.element.children("li").each(function(e){return function(t,n){return e.offsets.push($(n).position().left),e.width+=$(n).outerWidth(!0)}}(this)),h(1)(function(e){return function(){var t;return e.scrollLeft=e.element.scrollLeft(),t=e.element.outerWidth()/e.width,e.cardListView.element.css({position:"relative","-webkit-transform":"scale("+t+")",left:e.scrollLeft})}}(this))},e.prototype.unzoom=function(e){var t,n;return t=e.target,this.element.hasClass("zoomed")?(n=$(t).closest("ul.cards > li").index(),this.cardListView.element.css({"-webkit-transform":"none",left:this.scrollLeft-this.offsets[n]+"px"}),h(1)(function(e){return function(){return e.element.removeClass("zoomed")}}(this)),h(350)(function(e){return function(){return e.element.addClass("no_animation"),e.cardListView.element.css("left","0px"),e.element.scrollLeft(Math.min(e.offsets[n],e.width-e.element.width())),h(10)(function(){return e.element.removeClass("no_animation")})}}(this)),!1):void 0},e}(),c=function(){function e(e,t){var n;this.cardType=t,this.keys=function(){var t,r,i,s;for(i=e.match(/\{[^\}]+\}/g)||["id"],s=[],t=0,r=i.length;r>t;t++)n=i[t],s.push(n.replace("{","").replace("}","").replace("?",""));return s}(),this.pattern=new RegExp("^"+String(e).replace("/","/").replace(/\/?\{[^\}]+\?\}/g,"(?:/?([^/]+))?").replace(/\/?\{[^\}]+\}/g,"(?:/?([^/]+))")+"/?$")}return e.prototype.test=function(e){return this.pattern.test(e)},e.prototype.match=function(e){var t,r,i,s,o,a,u,c,l;for(c=this.pattern.exec(e),o=c[0],s=2<=c.length?n.call(c,1):[],i={},l=this.keys,t=a=0,u=l.length;u>a;t=++a)r=l[t],i[r]=null!=s?s[t]:void 0;return i},e}(),l=function(){function e(e){this.routes=e}return e.prototype.resolve=function(e){var t,n,r,i,s,o,a,u,c,l,d,h,f,v;if(h=e.match(/([^\?]*)\??(.*)/),c=h[0],s=h[1],o=h[2],a=function(){var e,t,n,r;for(n=this.routes,r=[],e=0,t=n.length;t>e;e++)a=n[e],a.test(s)&&r.push(a);return r}.call(this)[0])for(t=a.match(s),i={},f=function(){var e,t,n,i;for(n=o.split("&"),i=[],e=0,t=n.length;t>e;e++)r=n[e],i.push(r.split("="));return i}(),l=0,d=f.length;d>l;l++)v=f[l],n=v[0],u=v[1],i[n]=u;return[null!=a?a.cardType:void 0,t||{},i||{}]},e}(),o=function(){function t(e,t,n,r,i){this.cardList=e,this.view=t,this.viewport=n,this.element=r,this.router=i,$(document).event("click","a[href]").notBetween($(document).event("keydown").where(f.key(":leftcmd",":ctrl")),$(document).event("keyup").where(f.key(":leftcmd",":ctrl"))).subscribe(function(e){return function(t){return e.handle(t,!0)}}(this)),$(document).event("click","a[href]").between($(document).event("keydown").where(f.key(":leftcmd",":ctrl")),$(document).event("keyup").where(f.key(":leftcmd",":ctrl"))).subscribe(function(e){return function(t){return e.handle(t,!1)}}(this))}return t.prototype.handle=function(t,n){var r,i,s,o,a,u,c,l,d,h,f,v,p,m,g,y,b;if(m=t.target,d=function(e){return window.open(e,Date().split(" ").join(""))},r=$(m).closest("a"),i=r.hasClass("before"),u=r.attr("href"),y=u.match(/([^#\?]*)((?:#)[^\?]*)?(\?.*)?/)||[],g=y[0],f=y[1],a=y[2],p=y[3],v=(u.match(/^([^:\?]*):.*/)||["https"])[0],l=r.closest("li.card"),o=0===l.length?$("li.card").length:l.index("li.card")+1,("http"===v||"https"===v)&&(b=this.router.resolve(f),s=b[0],c=b[1],h=b[2]),h=h||{},h.location={protocol:v,path:f,fragment:a,query:p},f===location.origin+location.pathname)return location.hash="#"+a,$(document).scrollTop(0),!1;if(r.attr("download"))return!0;if(r.hasClass("permalink"))return d(u),!1;if(null!=s){if(r.is(".disabled"))return!1;r.addClass("disabled"),e([s],function(e){return function(t){var s;return s=new t(e.cardList,c,void 0,h),s.url=u,s.li.hasClass("singleton")&&l.hasClass("singleton")&&1===e.cardList.count()?e.element.animate({scrollLeft:0},500,function(){return e.cardList.replace(e.cardList.get(0),s)}):e.cardList.insert(o+(i?-1:0),s),n?e.view.event("ready").where(function(e){return e===s}).subscribe(function(){return r.removeClass("disabled"),e.viewport.state.index(s.li.index("li.card"))}):void 0}}(this))}else"#"===u[0]&&"mailto"!==v?history.pushState(null,null,window.location.pathname+u):"mailto"!==v&&"javascript"!==v&&d(u);return"mailto"===v},t}(),i=function(){function t(t,n,r,i){var s,h,v,p,m,g,y,b;this.external=r,this.constructors=i,this.element=$(t),this.menuElement=$(n),this.events=new f.EventRegistry("initialised","ready"),this.event("initialised").remember(1),this.event("ready").remember(1),this.event("ready").subscribe(function(e){return function(){return e.element.removeClass("loading")}}(this)),this.cards=new a(this.external,this),this.router=new l(function(){var e,t;e=this.constructors,t=[];for(g in e)s=e[g],t.push(new c(g,s));return t}.call(this)),m=this.element.children("li.card")[0],y=m?$(m).data("url"):window.location.pathname.substring(1),b=this.router.resolve(y),h=b[0],v=b[1],p=b[2],null==h&&(h=e(this.constructors[0].card)),p.zoomed=null==m,h&&e([h],function(e){return function(t){var n;return n=new t(e.cards,v,$(m),p),n.event("ready").republish(e.event("ready")),m&&e.cards.add(n),e.view=new u(e.cards,e.element),e.viewport=new d(e.view,e.element,e.menuElement,null!=e.external.offset),e.controller=new o(e.cards,e.view,e.viewport,e.element,e.router),m||e.cards.add(n),e.event("initialised").raise()}}(this))}return t.prototype.event=function(e){return this.events.get(e)},t}(),{Card:s,AjaxCard:r,List:a,ListView:u,ViewPort:d,Route:c,Router:l,Controller:o,Application:i}}),define("jview/drag",function(e){var $,t,n,i;return $=e("jquery"),i=e("jmodel/emerald"),e("jmodel-plugins/jquery.emerald"),t=function(){function e(e,t){this.element=$(e),this.extractors=new i.List.fromArray(t),this.element.find("*").attr("draggable",!1),this.element.attr("draggable",!0).event("dragstart").subscribe(function(e){return function(t){var n,r,i;return i=t.originalEvent,n=i.dataTransfer,r=t.target,n.dropEffect="none",e.extractors.each(function(e){var t,i,s;return s=e($(r)),i=s[0],t=s[1],n.setData(i,/json/.test(i)?JSON.stringify(t):t)})}}(this))}return e}(),n=function(){function e(e){var t,n;t=e.element,n=e.types,this.effect=e.effect,this.element=$(t),this.types=new i.List.fromArray(n),this.events=new i.EventRegistry("drop"),i.disjoin(this.element.event("dragenter",{preventDefault:!0}).where(function(e){return function(t){var n;return n=t.originalEvent.dataTransfer,e.accept(n)}}(this)).map(function(){return 1}),this.element.event("dragleave",{preventDefault:!0}).where(function(e){return function(t){var n;return n=t.originalEvent.dataTransfer,e.accept(n)}}(this)).map(function(){return-1}),this.element.event("drop",{preventDefault:!0}).map(function(){return 1})).accumulate(i.plus,0).subscribe(function(e){return function(t){return e.element.toggleClass("over",t>0)}}(this)),this.element.event("dragover",{preventDefault:!0}).map(function(e){var t;return t=e.originalEvent.dataTransfer}).where(function(e){return function(t){return e.accept(t)}}(this)).subscribe(function(e){return function(t){return t.dropEffect=e.effect,!1}}(this)),this.element.event("drop",{stopPropagation:!0}).map(function(e){var t;return t=e.originalEvent.dataTransfer}).subscribe(function(e){return function(t){return e.element.removeClass("over"),e.types.each(function(n){var r;return r=t.getData(n),""!==r?e.event("drop").raise(/json/.test(n)?JSON.parse(r):r,n):void 0}),!1}}(this))}return e.prototype.event=function(e){return this.events.get(e)},e.prototype.accept=function(e){return this.types.exists(function(t){return r.call(e.types,t)>=0})},e}(),{Source:t,Target:n}}),define("jview/hierarchy",function(e){var $,t,n,r;return $=e("jquery"),r=e("jmodel/topaz"),t=function(){function e(e){this.title=e.title,this.href=e.href,this.tail=e.tail}return e}(),n=function(){function e(e){this.element=$(e)}return e.prototype.renderNodes=function(e,t){return this.element.children("li").filter(function(e){return e>=t}).remove(),this.renderNode(e)},e.prototype.renderNode=function(e){return e&&(this.element.append($("<li/>").append($('<a class="singleton"/>').attr("href",e.href).text(e.title))),e.tail)?this.renderNode(e.tail):void 0},e}(),{Node:t,View:n}}),define("jview/palettes",function(e){var $,t,n;return $=e("jquery"),n=e("jmodel/topaz"),e("jmodel-plugins/jquery.emerald"),t=function(){function e(e,t,r){var i,s,o,a;this.parameters=t,this.constructors=r,this.dl=$(e),this.dt=this.dl.children("dt"),this.state=new n.ObservableObject({current:Number,open:Boolean(!1)},{repeat:!0}),this.palettes=function(){var e,t;e=this.constructors,t=[];for(i in e)s=e[i],o=this.dl.children("dd").filter(i),a=o.prev("dt"),t.push(new s(a,o,this));return t}.call(this),this.dt.event("click").map(function(e){return function(e){var t;return t=e.target,Math.floor($(t).index()/2)}}(this)).subscribe(function(e){return function(t){return e.state.current(t),e.state.open(function(e){return!e})}}(this)),this.state.event("open").subscribe(function(e){return function(t){return e.dt.each(function(n,r){return n!==e.state.current()?$(r).removeClass("open"):$(r).toggleClass("open",t)})}}(this))}return e}(),{Palettes:t}}),define("jview/cards",function(e){var $,r,i,s,o,a,u,c,l,d,h,f;return $=e("jquery"),f=e("jmodel/topaz"),e("jmodel-plugins/jquery.emerald"),e("jmodel-plugins/emerald.keys"),h=function(e){return function(t){return f.event.after(e).subscribe(t)}},$.target=function(e){return function(t){var n;return n=t.target,e.call($(n))}},s=function(){function e(){this.events=new f.EventRegistry("ready","dispose","current"),this.event("ready").remember(1),this.li=$(this.li?this.li:'<li class="card"/>'),this.li.addClass(this["class"]),this.li.event("click",".close").subscribe(function(e){return function(){return e.event("dispose").raise(e),!1}}(this))}return e.prototype.event=function(e){return this.events.get(e)},e}(),r=function(e){function n(){n.__super__.constructor.call(this),this.events.add("load",f.event.fromAjax(this.load)),this.event("load").subscribe(function(e){return function(t){return e.init(t)}}(this))}return t(n,e),n.prototype["class"]="",n.prototype.load=null,n.prototype.get=function(e){return this.event("load").start(e)},n.prototype.init=function(e){return this.li.html(e),this.li.toggleClass("error",$(e).hasClass("error")),this.url=this.li.children("article").data("url"),this.event("ready").raise(this)},n}(s),a=function(){function e(e,t){this.external=e,this.application=t,this.cards=new f.ObservableTypedList(s),this.events=new f.EventRegistry("add","insert","replace","remove","count","ready"),this.event("ready").remember(1),this.cards.events.republish({add:this.event("add"),insert:this.event("insert"),replace:this.event("replace"),remove:this.event("remove")}),f.disjoin(this.cards.event("add"),this.cards.event("insert"),this.cards.event("replace").map(function(e,t){return t})).subscribe(function(e){return function(t){return t.event("ready").subscribe(function(t){return e.event("ready").raise(t)}),t.event("dispose").subscribe(function(t){return e.cards.remove(t)})}}(this))}return e.prototype.event=function(e){return this.events.get(e)},e.prototype.add=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],(t=this.cards).add.apply(t,e)},e.prototype.insert=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],(t=this.cards).insert.apply(t,e)},e.prototype.replace=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],(t=this.cards).replace.apply(t,e)},e.prototype.remove=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],(t=this.cards).remove.apply(t,e)},e.prototype.get=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],(t=this.cards).get.apply(t,e)},e.prototype.count=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],(t=this.cards).count.apply(t,e)},e.prototype.first=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],(t=this.cards).first.apply(t,e)},e.prototype.each=function(){var e,t;return e=1<=arguments.length?n.call(arguments,0):[],(t=this.cards).each.apply(t,e)},e}(),u=function(){function e(e,t,r){this.cards=e,this.duration=null!=r?r:750,this.element=$(t),this.events=new f.EventRegistry("ready","removed"),this.cards.events.subscribe({add:function(e){return function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],e.add.apply(e,t)}}(this),insert:function(e){return function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],e.insert.apply(e,t)}}(this),replace:function(e){return function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],e.replace.apply(e,t)}}(this),remove:function(e){return function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],e.remove.apply(e,t)}}(this)})}return e.prototype.event=function(e){return this.events.get(e)},e.prototype.fold=function(){return this.element.find("li.card").each(function(e,t){return $(t).css({"-webkit-transform":"rotate("+(4*(e%2)-2)+"deg)",left:-1*$(t).position().left+100*e+"px"})})},e.prototype.add=function(e){return this.element.find("li.card").removeClass("zoomed"),this.element.append('<li class="extent"><ul><li class="label hidden"></li></ul></li>'),e.event("ready").take(1).subscribe(function(t){return function(){return e.li.children().addClass("adding"),h(1)(function(){return t.element.children("li.extent:last").children("ul").append(e.li),h(1)(function(){return e.li.children().removeClass("adding"),t.event("ready").raise(e),h(350)(function(){return t.element.find("li.extent > ul > li.label").removeClass("hidden")})})})}}(this))},e.prototype.insert=function(e,t){var n,r;return n=this.element.find("li.card"),n.removeClass("zoomed"),this.element.find("li.extent > ul > li.label").removeClass("hidden"),r=e.li,r.addClass("adding"),0===t?this.element.find("li.card").eq(0).before(r):this.element.find("li.card").eq(t-1).after(r),e.event("ready").take(1).subscribe(function(t){return function(){return h(1)(function(){var n;return n=Math.min(window.innerWidth,r.children("article").outerWidth(!0)),r.css("width",n),h(1)(function(){return r.removeClass("adding"),t.event("ready").raise(e)})})}}(this))},e.prototype.replace=function(e,t){return t.event("ready").take(1).subscribe(function(n){return function(){return e.li.removeClass("zoomed").after(t.li),t.li.removeClass("zoomed"),h(n.duration)(function(){return $("body").animate({scrollLeft:$("body").width()},1e3,function(){return e.li.remove(),t.li.addClass("zoomed"),h(350)(function(){return n.event("ready").raise(t)})})})}}(this))},e.prototype.remove=function(e){var t;return t=e.li,t.children().addClass("removing"),h(this.duration)(function(n){return function(){return t.addClass("removing"),h(1)(function(){var r;return r=t.closest("li.extent"),t.remove().removeClass("removing"),t.children().removeClass("removing"),n.event("removed").raise(e),0===r.find("li.card").length&&r.remove(),1===n.cards.count()?h(1)(function(){return n.element.find("li.card").addClass("zoomed"),n.element.find("li.extent > ul > li.label").addClass("hidden")}):void 0})}}(this))},e}(),d=function(){function e(e,t,n,r){var i;this.cardListView=e,this.offset=null!=r?r:64,this.element=$(t),this.controls=$(n),this.state=new f.ObservableObject({index:{type:Number,defaultValue:0,remember:1,repeat:!0}}),this.state.event("index").subscribe(function(e){return function(t){return e.scrollTo(t)}}(this)),this.state.event("index").subscribe(function(e){return function(t){var n,r;return"function"==typeof(n=e.cardListView.cards.get(t)).event&&null!=(r=n.event("current"))?r.raise():void 0}}(this)),f.conjoin(this.cardListView.element.event("mousedown","li.card"),this.cardListView.element.event("mouseup","li.card")).map(function(e,t){return{target:$(e.target),deltaX:t.screenX-e.screenX,deltaY:t.screenY-e.screenY}}).where(Function.and(function(e){var t;return t=e.target,0===t.closest("a").length},function(e){var t;return t=e.deltaX,t>-3&&3>t},function(e){var t;return t=e.deltaY,t>-3&&3>t})).subscribe(function(e){return function(t){var n,r;return n=t.target,r=n.closest("li.card").index("li.card"),r!==e.state.index()?e.state.index(n.closest("li.card").index("li.card")):void 0}}(this)),i=$(document).event("keydown").where(function(e){var t;return t=e.target,0===$(t).closest("input,select,textarea,[contentEditable=true]").length}),f.disjoin(i.where(f.key(":left")).map(function(){return-1}),i.where(f.key(":right")).map(function(){return 1})).subscribe(function(e){return function(t){return e.state.index(Math.max(0,Math.min(e.cardListView.cards.count()-1,e.state.index()+t))),!1}}(this)),f.disjoin(this.cardListView.event("ready"),this.cardListView.event("removed")).subscribe(function(e){return function(){return e.controls.toggleClass("hidden",1===e.cardListView.cards.count())}}(this)),this.cardListView.event("removed").subscribe(function(e){return function(){return e.state.index(Math.min(e.cardListView.cards.count()-1,e.state.index()+1))}}(this)),this.controls.find("button.zoom").event("click").subscribe(function(e){return function(t){return e.zoom(t)}}(this)),this.cardListView.element.event("click","li.card").subscribe(function(e){return function(t){return e.unzoom(t)}}(this)),this.controls.find("button.close").event("click").subscribe(function(e){return function(){return e.cardListView.cards.remove(function(e){return e.li.index("li.card")>0})}}(this)),f.disjoin(this.cardListView.event("ready"),this.cardListView.event("removed")).subscribe(function(e){return function(){var t;return t=e.cardListView.cards.count(),e.controls.find(".count").text(t+" card"+(1!==t?"s":""))}}(this)),f.disjoin(this.cardListView.event("ready"),this.state.event("index")).map(function(e){return function(){return[e.state.index(),e.cardListView.cards.count()]}}(this)).subscribe(function(e){return function(t){var n,r;return r=t[0],n=t[1],e.controls.find(".previous").toggleClass("disabled",2>n||0===r),e.controls.find(".next").toggleClass("disabled",2>n||r===n-1)}}(this)),f.disjoin(this.controls.find(".previous").event("click").tag(-1),this.controls.find(".next").event("click").tag(1)).where($.target(function(){return!this.hasClass("disabled")})).subscribe(function(e){return function(t,n){return e.state.index(function(e){return e+n})}}(this)),this.controls.find(".list").closest("li").event("click","a").subscribe(function(e){return function(t){var n;return n=t.target,e.state.index($(n).data("index")),e.controls.find(".list").closest("li").children("div").fadeOut(),!1}}(this)),this.controls.find(".list").event("click").subscribe(function(e){return function(t){var n,r,i;return i=t.target,n=$(i).closest("li").children("div"),n.is(":visible")?n.fadeOut():(r=n.children("ul"),r.children().remove(),e.cardListView.cards.each(function(e,t){return r.append($("<li><a data-index='"+t+"' href='#'>"+e.title+"</a></li>"))}),n.fadeIn())}}(this))}return e.offsets=[],e.width=0,e.scrollLeft=0,e.prototype.scrollTo=function(e,t){var n;return null==t&&(t=300),n=this.cardListView.element.find("li.card").eq(e),n.length>0?this.element.stop().animate({scrollLeft:this.element.scrollLeft()+n.position().left+parseInt(n.css("margin-left"),10)+"px"},t):void 0},e.prototype.nudge=function(){var e;return e=this.element.scrollLeft(),this.element.animate({scrollLeft:parseInt(e,10)+200},500,function(t){return function(){return f.event.after(500).subscribe(function(){return t.element.animate({scrollLeft:e},500)})}}(this))},e.prototype.zoom=function(e){return this.element.addClass("zoomed"),this.offsets=[],this.width=0,this.cardListView.element.children("li").each(function(e){return function(t,n){return e.offsets.push($(n).position().left),e.width+=$(n).outerWidth(!0)}}(this)),h(1)(function(e){return function(){var t;return e.scrollLeft=e.element.scrollLeft(),t=e.element.outerWidth()/e.width,e.cardListView.element.css({position:"relative","-webkit-transform":"scale("+t+")",left:e.scrollLeft})}}(this))},e.prototype.unzoom=function(e){var t,n;return t=e.target,this.element.hasClass("zoomed")?(n=$(t).closest("ul.cards > li").index(),this.cardListView.element.css({"-webkit-transform":"none",left:this.scrollLeft-this.offsets[n]+"px"}),h(1)(function(e){return function(){return e.element.removeClass("zoomed")}}(this)),h(350)(function(e){return function(){return e.element.addClass("no_animation"),e.cardListView.element.css("left","0px"),e.element.scrollLeft(Math.min(e.offsets[n],e.width-e.element.width())),h(10)(function(){return e.element.removeClass("no_animation")})}}(this)),!1):void 0},e}(),c=function(){function e(e,t){var n;this.cardType=t,this.keys=function(){var t,r,i,s;for(i=e.match(/\{[^\}]+\}/g)||["id"],s=[],t=0,r=i.length;r>t;t++)n=i[t],s.push(n.replace("{","").replace("}","").replace("?",""));return s}(),this.pattern=new RegExp("^"+String(e).replace("/","/").replace(/\/?\{[^\}]+\?\}/g,"(?:/?([^/]+))?").replace(/\/?\{[^\}]+\}/g,"(?:/?([^/]+))")+"/?$")}return e.prototype.test=function(e){return this.pattern.test(e)},e.prototype.match=function(e){var t,r,i,s,o,a,u,c,l;for(c=this.pattern.exec(e),o=c[0],s=2<=c.length?n.call(c,1):[],i={},l=this.keys,t=a=0,u=l.length;u>a;t=++a)r=l[t],i[r]=null!=s?s[t]:void 0;return i},e}(),l=function(){function e(e){this.routes=e}return e.prototype.resolve=function(e){var t,n,r,i,s,o,a,u,c,l,d,h,f,v;if(h=e.match(/([^\?]*)\??(.*)/),c=h[0],s=h[1],o=h[2],a=function(){var e,t,n,r;for(n=this.routes,r=[],e=0,t=n.length;t>e;e++)a=n[e],a.test(s)&&r.push(a);return r}.call(this)[0])for(t=a.match(s),i={},f=function(){var e,t,n,i;for(n=o.split("&"),i=[],e=0,t=n.length;t>e;e++)r=n[e],i.push(r.split("="));
return i}(),l=0,d=f.length;d>l;l++)v=f[l],n=v[0],u=v[1],i[n]=u;return[null!=a?a.cardType:void 0,t||{},i||{}]},e}(),o=function(){function t(e,t,n,r,i){this.cardList=e,this.view=t,this.viewport=n,this.element=r,this.router=i,$(document).event("click","a[href]").notBetween($(document).event("keydown").where(f.key(":leftcmd",":ctrl")),$(document).event("keyup").where(f.key(":leftcmd",":ctrl"))).subscribe(function(e){return function(t){return e.handle(t,!0)}}(this)),$(document).event("click","a[href]").between($(document).event("keydown").where(f.key(":leftcmd",":ctrl")),$(document).event("keyup").where(f.key(":leftcmd",":ctrl"))).subscribe(function(e){return function(t){return e.handle(t,!1)}}(this))}return t.prototype.handle=function(t,n){var r,i,s,o,a,u,c,l,d,h,f,v,p,m,g,y,b;if(m=t.target,d=function(e){return window.open(e,Date().split(" ").join(""))},r=$(m).closest("a"),i=r.hasClass("before"),u=r.attr("href"),y=u.match(/([^#\?]*)((?:#)[^\?]*)?(\?.*)?/)||[],g=y[0],f=y[1],a=y[2],p=y[3],v=(u.match(/^([^:\?]*):.*/)||["https"])[0],l=r.closest("li.card"),o=0===l.length?$("li.card").length:l.index("li.card")+1,("http"===v||"https"===v)&&(b=this.router.resolve(f),s=b[0],c=b[1],h=b[2]),h=h||{},h.location={protocol:v,path:f,fragment:a,query:p},f===location.origin+location.pathname)return location.hash="#"+a,$(document).scrollTop(0),!1;if(r.attr("download"))return!0;if(r.hasClass("permalink"))return d(u),!1;if(null!=s){if(r.is(".disabled"))return!1;r.addClass("disabled"),e([s],function(e){return function(t){var s;return s=new t(e.cardList,c,void 0,h),s.url=u,s.li.hasClass("singleton")&&l.hasClass("singleton")&&1===e.cardList.count()?e.element.animate({scrollLeft:0},500,function(){return e.cardList.replace(e.cardList.get(0),s)}):e.cardList.insert(o+(i?-1:0),s),n?e.view.event("ready").where(function(e){return e===s}).subscribe(function(){return r.removeClass("disabled"),e.viewport.state.index(s.li.index("li.card"))}):void 0}}(this))}else"#"===u[0]&&"mailto"!==v?history.pushState(null,null,window.location.pathname+u):"mailto"!==v&&"javascript"!==v&&d(u);return"mailto"===v},t}(),i=function(){function t(t,n,r,i){var s,h,v,p,m,g,y,b;this.external=r,this.constructors=i,this.element=$(t),this.menuElement=$(n),this.events=new f.EventRegistry("initialised","ready"),this.event("initialised").remember(1),this.event("ready").remember(1),this.event("ready").subscribe(function(e){return function(){return e.element.removeClass("loading")}}(this)),this.cards=new a(this.external,this),this.router=new l(function(){var e,t;e=this.constructors,t=[];for(g in e)s=e[g],t.push(new c(g,s));return t}.call(this)),m=this.element.children("li.card")[0],y=m?$(m).data("url"):window.location.pathname.substring(1),b=this.router.resolve(y),h=b[0],v=b[1],p=b[2],null==h&&(h=e(this.constructors[0].card)),p.zoomed=null==m,h&&e([h],function(e){return function(t){var n;return n=new t(e.cards,v,$(m),p),n.event("ready").republish(e.event("ready")),m&&e.cards.add(n),e.view=new u(e.cards,e.element),e.viewport=new d(e.view,e.element,e.menuElement,null!=e.external.offset),e.controller=new o(e.cards,e.view,e.viewport,e.element,e.router),m||e.cards.add(n),e.event("initialised").raise()}}(this))}return t.prototype.event=function(e){return this.events.get(e)},t}(),{Card:s,AjaxCard:r,List:a,ListView:u,ViewPort:d,Route:c,Router:l,Controller:o,Application:i}}),define("jview/drag",function(e){var $,t,n,i;return $=e("jquery"),i=e("jmodel/emerald"),e("jmodel-plugins/jquery.emerald"),t=function(){function e(e,t){this.element=$(e),this.extractors=new i.List.fromArray(t),this.element.find("*").attr("draggable",!1),this.element.attr("draggable",!0).event("dragstart").subscribe(function(e){return function(t){var n,r,i;return i=t.originalEvent,n=i.dataTransfer,r=t.target,n.dropEffect="none",e.extractors.each(function(e){var t,i,s;return s=e($(r)),i=s[0],t=s[1],n.setData(i,/json/.test(i)?JSON.stringify(t):t)})}}(this))}return e}(),n=function(){function e(e){var t,n;t=e.element,n=e.types,this.effect=e.effect,this.element=$(t),this.types=new i.List.fromArray(n),this.events=new i.EventRegistry("drop"),i.disjoin(this.element.event("dragenter",{preventDefault:!0}).where(function(e){return function(t){var n;return n=t.originalEvent.dataTransfer,e.accept(n)}}(this)).map(function(){return 1}),this.element.event("dragleave",{preventDefault:!0}).where(function(e){return function(t){var n;return n=t.originalEvent.dataTransfer,e.accept(n)}}(this)).map(function(){return-1}),this.element.event("drop",{preventDefault:!0}).map(function(){return 1})).accumulate(i.plus,0).subscribe(function(e){return function(t){return e.element.toggleClass("over",t>0)}}(this)),this.element.event("dragover",{preventDefault:!0}).map(function(e){var t;return t=e.originalEvent.dataTransfer}).where(function(e){return function(t){return e.accept(t)}}(this)).subscribe(function(e){return function(t){return t.dropEffect=e.effect,!1}}(this)),this.element.event("drop",{stopPropagation:!0}).map(function(e){var t;return t=e.originalEvent.dataTransfer}).subscribe(function(e){return function(t){return e.element.removeClass("over"),e.types.each(function(n){var r;return r=t.getData(n),""!==r?e.event("drop").raise(/json/.test(n)?JSON.parse(r):r,n):void 0}),!1}}(this))}return e.prototype.event=function(e){return this.events.get(e)},e.prototype.accept=function(e){return this.types.exists(function(t){return r.call(e.types,t)>=0})},e}(),{Source:t,Target:n}}),define("jview/hierarchy",function(e){var $,t,n,r;return $=e("jquery"),r=e("jmodel/topaz"),t=function(){function e(e){this.title=e.title,this.href=e.href,this.tail=e.tail}return e}(),n=function(){function e(e){this.element=$(e)}return e.prototype.renderNodes=function(e,t){return this.element.children("li").filter(function(e){return e>=t}).remove(),this.renderNode(e)},e.prototype.renderNode=function(e){return e&&(this.element.append($("<li/>").append($('<a class="singleton"/>').attr("href",e.href).text(e.title))),e.tail)?this.renderNode(e.tail):void 0},e}(),{Node:t,View:n}}),define("jview/palettes",function(e){var $,t,n;return $=e("jquery"),n=e("jmodel/topaz"),e("jmodel-plugins/jquery.emerald"),t=function(){function e(e,t,r){var i,s,o,a;this.parameters=t,this.constructors=r,this.dl=$(e),this.dt=this.dl.children("dt"),this.state=new n.ObservableObject({current:Number,open:Boolean(!1)},{repeat:!0}),this.palettes=function(){var e,t;e=this.constructors,t=[];for(i in e)s=e[i],o=this.dl.children("dd").filter(i),a=o.prev("dt"),t.push(new s(a,o,this));return t}.call(this),this.dt.event("click").map(function(e){return function(e){var t;return t=e.target,Math.floor($(t).index()/2)}}(this)).subscribe(function(e){return function(t){return e.state.current(t),e.state.open(function(e){return!e})}}(this)),this.state.event("open").subscribe(function(e){return function(t){return e.dt.each(function(n,r){return n!==e.state.current()?$(r).removeClass("open"):$(r).toggleClass("open",t)})}}(this))}return e}(),{Palettes:t}})}).call(this);