(function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("jview/drag",function(t){var $,n,r,i;return $=t("jquery"),i=t("jmodel/emerald"),t("jmodel-plugins/jquery.emerald"),n=function(){function e(e,t){this.element=$(e),this.extractors=new i.List.fromArray(t),this.element.find("*").attr("draggable",!1),this.element.attr("draggable",!0).event("dragstart").subscribe(function(e){return function(t){var n,r,i;return i=t.originalEvent,n=i.dataTransfer,r=t.target,n.dropEffect="none",e.extractors.each(function(e){var t,i,a;return a=e($(r)),i=a[0],t=a[1],n.setData(i,/json/.test(i)?JSON.stringify(t):t)})}}(this))}return e}(),r=function(){function t(e){var t,n;t=e.element,n=e.types,this.effect=e.effect,this.element=$(t),this.types=new i.List.fromArray(n),this.events=new i.EventRegistry("drop"),i.disjoin(this.element.event("dragenter",{preventDefault:!0}).where(function(e){return function(t){var n;return n=t.originalEvent.dataTransfer,e.accept(n)}}(this)).map(function(){return 1}),this.element.event("dragleave",{preventDefault:!0}).where(function(e){return function(t){var n;return n=t.originalEvent.dataTransfer,e.accept(n)}}(this)).map(function(){return-1}),this.element.event("drop",{preventDefault:!0}).map(function(){return 1})).accumulate(i.plus,0).subscribe(function(e){return function(t){return e.element.toggleClass("over",t>0)}}(this)),this.element.event("dragover",{preventDefault:!0}).map(function(e){var t;return t=e.originalEvent.dataTransfer}).where(function(e){return function(t){return e.accept(t)}}(this)).subscribe(function(e){return function(t){return t.dropEffect=e.effect,!1}}(this)),this.element.event("drop",{stopPropagation:!0}).map(function(e){var t;return t=e.originalEvent.dataTransfer}).subscribe(function(e){return function(t){return e.element.removeClass("over"),e.types.each(function(n){var r;return r=t.getData(n),""!==r?e.event("drop").raise(/json/.test(n)?JSON.parse(r):r,n):void 0}),!1}}(this))}return t.prototype.event=function(e){return this.events.get(e)},t.prototype.accept=function(t){return this.types.exists(function(n){return e.call(t.types,n)>=0})},t}(),{Source:n,Target:r}})}).call(this);